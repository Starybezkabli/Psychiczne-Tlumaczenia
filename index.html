<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Psychiczne t≈Çumaczenia ‚Äî Ultimate Batoto Style</title>

<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

<style>
body{margin:0;font-family:system-ui,sans-serif;background:#0b0016;color:#e9d5ff}
header{background:#2e1065;padding:10px;position:sticky;top:0;z-index:10}
.subbar{background:#1a0033;padding:6px;border-top:1px solid #5b21b6}
input,textarea,select{width:100%;background:#1a0033;border:1px solid #5b21b6;color:white;padding:8px;border-radius:6px;margin-bottom:6px}
button{background:#6d28d9;border:none;padding:8px 12px;border-radius:6px;color:white;cursor:pointer;margin:4px 0}
button:hover{background:#7c3aed}
.card{background:#1a0033;border:1px solid #5b21b6;padding:12px;border-radius:10px;margin-bottom:12px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px}
.tag{display:inline-block;background:#3b0764;padding:4px 8px;border-radius:999px;margin:2px;font-size:12px;cursor:pointer}
.cover{width:100%;height:260px;object-fit:cover;border-radius:8px}
.chapter{padding:8px;border:1px solid #5b21b6;border-radius:6px;margin-bottom:6px;cursor:pointer}
.reader{max-width:900px;margin:auto}
.reader img{width:100%;display:block;margin-bottom:6px;border-radius:8px}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.9);overflow:auto;padding:20px;z-index:100}
.searchBox{position:absolute;background:#1a0033;border:1px solid #5b21b6;width:320px;max-height:320px;overflow:auto;border-radius:8px}
.searchItem{padding:6px;cursor:pointer}
.searchItem:hover{background:#2e1065}
.flex{display:flex;gap:8px;flex-wrap:wrap}
</style>
</head>
<body>
<div id="root"></div>

<script>
const e=React.createElement;

// ===== TAGS (UNCHANGED ‚Äî ALL PRESERVED) =====
const TAGS=[
"yaoi","yuri","hetero","romans","akcja","kryminalne","horror","krwawe","wampiry","inny ≈õwiat","fantasy",
"wilko≈Çaki","dziewczyny","ch≈Çopcy","przyjaciele z dzieci≈Ñstwa","rodzina kr√≥lewska","psychologiczne","kosmici",
"szkolne","policja","historyczne","slice of life","omegaverse","wojna","walki","morderstwa","lochy","potwory",
"magiczne","auta","wy≈õcigi","drama","r√≥≈ºnica wieku","demony","anio≈Çy","zagadki","ninja","zmiana cia≈Ç","komedia",
"duchy","dzieci","dla doros≈Çych","medyczne","sm/bdsm/sub-dom","gry wideo","muzyka","konkurencje","wr√≥≈ºki","fetysze",
"zemsta","klƒÖtwy"
];

const TYPES=["manhwa","manga","manhua","novelka","webtoon","one shot"];
const ADMIN_PASS="admin123";

const load=(k,d)=>JSON.parse(localStorage.getItem(k)||JSON.stringify(d));
const save=(k,v)=>localStorage.setItem(k,JSON.stringify(v));
const uid=()=>Date.now()+Math.random();

// ===== APP =====
function App(){
  const [series,setSeries]=React.useState(load("series",[]));
  const [user,setUser]=React.useState(load("user",null));
  const [view,setView]=React.useState("home");
  const [active,setActive]=React.useState(null);
  const [query,setQuery]=React.useState("");
  const [showSearch,setShowSearch]=React.useState(false);
  const [reader,setReader]=React.useState(null);

  React.useEffect(()=>save("series",series),[series]);
  React.useEffect(()=>save("user",user),[user]);

  const filtered=series.filter(s=>{
    const q=query.toLowerCase();
    return s.title.toLowerCase().includes(q)||s.tags.some(t=>t.toLowerCase().includes(q));
  });

  function toggleLibrary(id){
    if(!user) return;
    const lib=user.library||[];
    const updated=lib.includes(id)?lib.filter(x=>x!==id):[...lib,id];
    setUser({...user,library:updated});
  }

  return e("div",null,

    // HEADER
    e("header",null,
      e("div",{className:"flex",style:{position:"relative"}},
        e("b",{style:{cursor:"pointer"},onClick:()=>{setView("home");setActive(null);}},"Psychiczne t≈Çumaczenia"),

        e("input",{
          placeholder:"Szukaj tytu≈Çu/tagu‚Ä¶",
          value:query,
          onFocus:()=>setShowSearch(true),
          onBlur:()=>setTimeout(()=>setShowSearch(false),200),
          onChange:e=>setQuery(e.target.value)
        }),

        showSearch && query && e("div",{className:"searchBox"},
          filtered.map(s=>e("div",{
            key:s.id,
            className:"searchItem",
            onClick:()=>{setActive(s);setView("series");setShowSearch(false);}
          },"üìñ "+s.title))
        ),

        user
          ?e("button",{onClick:()=>setUser(null)},"Wyloguj")
          :e("button",{onClick:()=>setView("login")},"Login"),

        user?.admin && e("button",{onClick:()=>setView("admin")},"Administracja")
      ),

      e("div",{className:"subbar"},
        TAGS.map(t=>e("span",{key:t,className:"tag",onClick:()=>setQuery(t)},t))
      )
    ),

    // VIEWS
    e("div",{style:{padding:12}},
      view==="home" && e(Home,{series:filtered,open:s=>{setActive(s);setView("series");},user,toggleLibrary}),
      view==="series" && active && e(Series,{data:active,setReader,user,setSeries}),
      view==="admin" && user?.admin && e(Admin,{add:s=>setSeries([...series,s])}),
      view==="login" && e(Login,{setUser})
    ),

    // BATOTO READER
    reader && e("div",{className:"overlay",onClick:()=>setReader(null)},
      e("div",{className:"reader",onClick:e=>e.stopPropagation()},
        e("button",{onClick:()=>setReader(null)},"Zamknij czytnik"),
        reader.images.map((img,i)=>e("img",{key:i,src:img,loading:"lazy"}))
      )
    )
  );
}

// ===== HOME =====
function Home({series,open,user,toggleLibrary}){
  return e("div",{className:"grid"},
    series.map(s=>{
      const saved=user?.library?.includes(s.id);
      return e("div",{key:s.id,className:"card"},
        s.cover && e("img",{src:s.cover,className:"cover"}),
        e("b",{style:{cursor:"pointer"},onClick:()=>open(s)},s.title),
        e("div",null,s.tags.map(t=>e("span",{key:t,className:"tag"},t))),
        user && e("button",{onClick:()=>toggleLibrary(s.id)},saved?"‚úì W bibliotece":"Ôºã Dodaj do biblioteki")
      );
    })
  );
}

// ===== SERIES =====
function Series({data,setReader,user,setSeries}){
  const [ctitle,setCtitle]=React.useState("");
  const [cimages,setCimages]=React.useState([]);
  const [comment,setComment]=React.useState({});

  function upload(e){
    const files=[...e.target.files];
    Promise.all(files.map(f=>new Promise(res=>{
      const r=new FileReader();
      r.onload=()=>res(r.result);
      r.readAsDataURL(f);
    }))).then(setCimages);
  }

  function addChapter(){
    if(!user?.admin||!ctitle) return;
    const ch={id:uid(),title:ctitle,images:cimages,comments:[],rating:0};
    const updated={...data,chapters:[...(data.chapters||[]),ch]};
    setSeries(prev=>prev.map(s=>s.id===data.id?updated:s));
    setCtitle("");setCimages([]);
  }

  function addComment(id){
    const text=comment[id];
    if(!user||!text) return;
    const updated={
      ...data,
      chapters:data.chapters.map(c=>c.id===id
        ?{...c,comments:[...c.comments,{user:user.name,text}]}
        :c)
    };
    setSeries(prev=>prev.map(s=>s.id===data.id?updated:s));
    setComment({...comment,[id]:""});
  }

  function rate(id){
    const updated={
      ...data,
      chapters:data.chapters.map(c=>c.id===id?{...c,rating:c.rating+1}:c)
    };
    setSeries(prev=>prev.map(s=>s.id===data.id?updated:s));
  }

  return e("div",null,
    e("div",{className:"card"},
      e("h2",null,data.title),
      data.cover && e("img",{src:data.cover,className:"cover"}),
      e("p",null,data.description)
    ),

    user?.admin && e("div",{className:"card"},
      e("h3",null,"Dodaj rozdzia≈Ç"),
      e("input",{placeholder:"Tytu≈Ç",value:ctitle,onChange:e=>setCtitle(e.target.value)}),
      e("input",{type:"file",multiple:true,accept:"image/*",onChange:upload}),
      e("button",{onClick:addChapter},"Dodaj")
    ),

    (data.chapters||[]).map(ch=>e("div",{key:ch.id,className:"card"},
      e("div",{className:"chapter",onClick:()=>setReader(ch)},"üìñ "+ch.title),
      e("button",{onClick:()=>rate(ch.id)},"‚≠ê "+ch.rating),

      e("h4",null,"Komentarze"),
      ch.comments.map((c,i)=>e("div",{key:i},e("b",null,c.user+": "),c.text)),

      user && e("div",null,
        e("input",{
          placeholder:"Dodaj komentarz‚Ä¶",
          value:comment[ch.id]||"",
          onChange:e=>setComment({...comment,[ch.id]:e.target.value})
        }),
        e("button",{onClick:()=>addComment(ch.id)},"Dodaj")
      )
    ))
  );
}

// ===== ADMIN =====
function Admin({add}){
  const [title,setTitle]=React.useState("");
  const [desc,setDesc]=React.useState("");
  const [tags,setTags]=React.useState([]);
  const [type,setType]=React.useState(TYPES[0]);
  const [cover,setCover]=React.useState(null);

  function upload(e){
    const f=e.target.files[0];
    const r=new FileReader();
    r.onload=()=>setCover(r.result);
    r.readAsDataURL(f);
  }

  function create(){
    if(!title) return;
    add({id:uid(),title,description:desc,type,tags,cover,chapters:[]});
    setTitle("");setDesc("");setTags([]);setCover(null);
  }

  return e("div",{className:"card"},
    e("h3",null,"Dodaj tytu≈Ç"),
    e("input",{placeholder:"Tytu≈Ç",value:title,onChange:e=>setTitle(e.target.value)}),
    e("textarea",{placeholder:"Opis",value:desc,onChange:e=>setDesc(e.target.value)}),
    e("select",{value:type,onChange:e=>setType(e.target.value)},TYPES.map(t=>e("option",{key:t},t))),
    e("input",{type:"file",accept:"image/*",onChange:upload}),
    e("div",null,
      TAGS.map(t=>e("span",{key:t,className:"tag",
        style:{background:tags.includes(t)?"#9333ea":"#3b0764"},
        onClick:()=>setTags(tags.includes(t)?tags.filter(x=>x!==t):[...tags,t])
      },t))
    ),
    e("button",{onClick:create},"Dodaj")
  );
}

// ===== LOGIN =====
function Login({setUser}){
  const [name,setName]=React.useState("");
  const [mail,setMail]=React.useState("");
  const [pass,setPass]=React.useState("");

  function login(){
    if(!name||!mail) return;
    setUser({name,mail,admin:pass===ADMIN_PASS,library:[]});
  }

  return e("div",{className:"card"},
    e("input",{placeholder:"Nick",value:name,onChange:e=>setName(e.target.value)}),
    e("input",{placeholder:"Email",value:mail,onChange:e=>setMail(e.target.value)}),
    e("input",{placeholder:"Has≈Ço admina",type:"password",value:pass,onChange:e=>setPass(e.target.value)}),
    e("button",{onClick:login},"Wejd≈∫")
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(e(App));
</script>
</body>
</html>
