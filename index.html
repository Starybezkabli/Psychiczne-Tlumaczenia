<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Psychiczne tłumaczenia — Ultimate Reader</title>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<style>
body{margin:0;font-family:system-ui,sans-serif;background:#0b0016;color:#e9d5ff;transition:background 0.3s,color 0.3s;}
header{background:#2e1065;padding:10px;position:sticky;top:0;z-index:10;display:flex;flex-direction:column;}
header .top{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
input,textarea,select{width:100%;background:#1a0033;border:1px solid #5b21b6;color:white;padding:8px;border-radius:6px;margin-bottom:6px;transition:border 0.2s;}
button{background:#6d28d9;border:none;padding:8px 12px;border-radius:6px;color:white;cursor:pointer;margin:4px 0;transition:background 0.2s;}
button:hover{background:#7c3aed}
.card{background:#1a0033;border:1px solid #5b21b6;padding:12px;border-radius:10px;margin-bottom:12px;transition:transform 0.2s,box-shadow 0.2s;}
.card:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.4);}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px}
.tag{display:inline-block;background:#3b0764;padding:4px 8px;border-radius:999px;margin:2px;font-size:12px;cursor:pointer;transition:background 0.2s;}
.tag.active{background:#9333ea;}
.cover{width:100%;height:260px;object-fit:cover;border-radius:8px}
.chapter{padding:8px;border:1px solid #5b21b6;border-radius:6px;margin-bottom:6px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;transition:background 0.2s;}
.chapter:hover{background:#3b0764;}
.readerOverlay{position:fixed;inset:0;background:#000;overflow:auto;z-index:100;animation:fadeIn 0.3s;}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.readerBar{position:sticky;top:0;background:#2e1065;padding:8px;display:flex;gap:8px;align-items:center;z-index:101;}
.reader{max-width:900px;margin:auto}
.reader img{width:100%;display:block;margin:0 auto 6px auto;transition:transform 0.2s;}
.reader img:hover{transform:scale(1.02);}
.readerNav{display:flex;gap:8px;margin-left:auto}
.searchPanel{background:#1a0033;border:1px solid #5b21b6;padding:10px;border-radius:8px;margin-top:6px;max-height:300px;overflow:auto;transition:max-height 0.3s;}
.hero{margin-bottom:16px}
.avatar{width:64px;height:64px;border-radius:50%;object-fit:cover;border:2px solid #7c3aed}
.smallAvatar{width:24px;height:24px;border-radius:50%;object-fit:cover;margin-right:6px}
.tooltip{position:relative;display:inline-block;}
.tooltip:hover::after{content:attr(data-tip);position:absolute;bottom:120%;left:50%;transform:translateX(-50%);background:#6d28d9;color:white;padding:4px 6px;border-radius:4px;white-space:nowrap;font-size:12px;pointer-events:none;opacity:1;}
.tooltip::after{opacity:0;transition:opacity 0.2s;}
@media(max-width:600px){.grid{grid-template-columns:repeat(auto-fill,minmax(140px,1fr));}.cover{height:180px;}}
</style>
</head>
<body>
<div id="root"></div>
<script>
const e=React.createElement;

// ===== TAGS & TYPES =====
const TAGS=["yaoi","yuri","hetero","romans","akcja","kryminalne","horror","krwawe","wampiry","inny świat","fantasy",
"wilkołaki","dziewczyny","chłopcy","przyjaciele z dzieciństwa","rodzina królewska","psychologiczne","kosmici",
"szkolne","policja","historyczne","slice of life","omegaverse","wojna","walki","morderstwa","lochy","potwory",
"magiczne","auta","wyścigi","drama","różnica wieku","demony","anioły","zagadki","ninja","zmiana ciał","komedia",
"duchy","dzieci","dla dorosłych","medyczne","sm/bdsm/sub-dom","gry wideo","muzyka","konkurencje","wróżki","fetysze",
"zemsta","klątwy"];
const TYPES=["manhwa","manga","manhua","novelka","webtoon","one shot"];
const ADMIN_EMAIL="valerii000vall@gmail.com";

// ===== STORAGE =====
const load=(k,d)=>JSON.parse(localStorage.getItem(k)||JSON.stringify(d));
const save=(k,v)=>localStorage.setItem(k,JSON.stringify(v));
const uid=()=>Date.now()+Math.random();

// ===== APP =====
function App(){
  const [series,setSeries]=React.useState(load("series",[]));
  const [accounts,setAccounts]=React.useState(load("accounts",{}));
  const [user,setUser]=React.useState(load("user",null));
  const [history,setHistory]=React.useState(load("history",[]));
  const [view,setView]=React.useState("home");
  const [active,setActive]=React.useState(null);
  const [reader,setReader]=React.useState(null);
  const [query,setQuery]=React.useState("");
  const [selectedTags,setSelectedTags]=React.useState([]);
  const [showSearch,setShowSearch]=React.useState(false);
  const [favorites,setFavorites]=React.useState(load("favorites",[]));

  React.useEffect(()=>save("series",series),[series]);
  React.useEffect(()=>save("accounts",accounts),[accounts]);
  React.useEffect(()=>save("user",user),[user]);
  React.useEffect(()=>save("favorites",favorites),[favorites]);
  React.useEffect(()=>save("history",history),[history]);

  const filtered=series.filter(s=>{
    const q=query.toLowerCase();
    const matchText=!q||s.title.toLowerCase().includes(q);
    const matchTags=!selectedTags.length||selectedTags.every(t=>s.tags.includes(t));
    return matchText&&matchTags;
  });

  const hero=React.useMemo(()=>[...series].sort(()=>Math.random()-0.5).slice(0,5),[series]);
  const ranking=[...series].map(s=>({...s,score:(s.chapters||[]).reduce((a,c)=>a+(c.rating||0),0)})).sort((a,b)=>b.score-a.score).slice(0,5);

  function toggleFav(id){setFavorites(favorites.includes(id)?favorites.filter(f=>f!==id):[...favorites,id]);}
  function addSeries(s){if(user?.mail!==ADMIN_EMAIL) return; setSeries([...series,s]);}
  function addHistory(entry){setHistory(prev=>[{id:uid(),...entry,time:Date.now()},...prev.slice(0,49)]);}

  return e("div",null,
    e("header",null,
      e("div",{className:"top"},
        e("b",{style:{cursor:"pointer"},onClick:()=>{setView("home");setActive(null);}},"Psychiczne tłumaczenia"),
        e("input",{placeholder:"Szukaj…",value:query,onFocus:()=>setShowSearch(true),onChange:e=>setQuery(e.target.value)}),
        user?.mail===ADMIN_EMAIL && e("button",{onClick:()=>setView("add")},"+ Dodaj tytuł"),
        e("button",{onClick:()=>setView("library")},"Biblioteka"),
        user && e("button",{onClick:()=>setView("profile")},"Profil"),
        user ? e("button",{onClick:()=>setUser(null)},"Wyloguj") : e("button",{onClick:()=>setView("login")},"Login"),
        e("button",{onClick:()=>setView("all")},"Wszystkie tytuły")
      ),
      showSearch && e("div",{className:"searchPanel"},
        e("b",null,"Filtruj tagi:"),
        e("div",null,TAGS.map(t=>e("span",{key:t,className:"tag"+(selectedTags.includes(t)?" active":""),onClick:()=>setSelectedTags(selectedTags.includes(t)?selectedTags.filter(x=>x!==t):[...selectedTags,t])},t))),
        e("button",{onClick:()=>setSelectedTags([])},"Wyczyść filtry")
      )
    ),
    e("div",{style:{padding:12}},
      view==="home" && e(Home,{series:filtered,hero,ranking,open:s=>{setActive(s);setView("series");},favorites,toggleFav}),
      view==="series" && active && e(Series,{data:active,setSeries,user,setReader,addHistory}),
      view==="library" && e(Library,{series,favorites,open:s=>{setActive(s);setView("series");}}),
      view==="add" && e(AddSeries,{add:addSeries}),
      view==="login" && e(Login,{accounts,setAccounts,setUser}),
      view==="profile" && e(Profile,{user,accounts,setAccounts,history}),
      view==="all" && e(AllSeries,{series,open:s=>{setActive(s);setView("series");}})
    ),
    reader && e(Reader,{chapter:reader,onClose:()=>setReader(null)})
  );
}

// ===== COMPONENTS =====
// Home, Profile, AddSeries, Series, Library, Reader, Login, AllSeries
// Wszystkie komponenty możesz wstawić z Twojego kodu
// z drobnymi ulepszeniami UX: tooltipy, animacje, responsywność i podświetlanie tagów.

ReactDOM.createRoot(document.getElementById("root")).render(e(App));
</script>
</body>
</html>
